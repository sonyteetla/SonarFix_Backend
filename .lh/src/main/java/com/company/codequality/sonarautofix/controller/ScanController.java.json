{
    "sourceFile": "src/main/java/com/company/codequality/sonarautofix/controller/ScanController.java",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1772176343996,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1772176343996,
            "name": "Commit-0",
            "content": "package com.company.codequality.sonarautofix.controller;\r\n\r\nimport com.company.codequality.sonarautofix.model.ScanTask;\r\nimport com.company.codequality.sonarautofix.service.ScanService;\r\nimport org.springframework.http.ResponseEntity;\r\nimport org.springframework.web.bind.annotation.*;\r\n\r\nimport java.util.Map;\r\n\r\n@RestController\r\n@RequestMapping(\"/api/scan\")\r\n@CrossOrigin(\"*\")\r\npublic class ScanController {\r\n\r\n    private final ScanService scanService;\r\n\r\n    public ScanController(ScanService scanService) {\r\n        this.scanService = scanService;\r\n    }\r\n\r\n    // =====================================\r\n    // START NEW PROJECT SCAN\r\n    // =====================================\r\n    @PostMapping(\"/start\")\r\n    public ResponseEntity<?> startNewScan(\r\n            @RequestParam(\"projectPath\") String projectPath) {\r\n\r\n        String scanId = scanService.startNewScan(projectPath);\r\n        ScanTask task = scanService.getScanTask(scanId);\r\n\r\n        if (task == null) {\r\n            return ResponseEntity.internalServerError()\r\n                    .body(Map.of(\"error\", \"Failed to create scan task\"));\r\n        }\r\n\r\n        return ResponseEntity.ok(Map.of(\r\n                \"scanId\", scanId,\r\n                \"projectKey\", task.getProjectKey(),\r\n                \"status\", task.getStatus()\r\n        ));\r\n    }\r\n\r\n    // =====================================\r\n    // RE-SCAN EXISTING PROJECT\r\n    // =====================================\r\n    @PostMapping(\"/rescan\")\r\n    public ResponseEntity<?> reScan(\r\n            @RequestParam(\"projectPath\") String projectPath,\r\n            @RequestParam(\"projectKey\") String projectKey) {\r\n\r\n        String scanId = scanService.reScan(projectPath, projectKey);\r\n        ScanTask task = scanService.getScanTask(scanId);\r\n\r\n        if (task == null) {\r\n            return ResponseEntity.internalServerError()\r\n                    .body(Map.of(\"error\", \"Failed to create rescan task\"));\r\n        }\r\n\r\n        return ResponseEntity.ok(Map.of(\r\n                \"scanId\", scanId,\r\n                \"projectKey\", task.getProjectKey(),\r\n                \"status\", task.getStatus()\r\n        ));\r\n    }\r\n\r\n    // =====================================\r\n    // CHECK SCAN STATUS\r\n    // =====================================\r\n    @GetMapping(\"/status/{scanId}\")\r\n    public ResponseEntity<?> getStatus(\r\n            @PathVariable(\"scanId\") String scanId) {\r\n\r\n        ScanTask task = scanService.getScanTask(scanId);\r\n\r\n        if (task == null) {\r\n            return ResponseEntity.notFound()\r\n                    .build();\r\n        }\r\n\r\n        return ResponseEntity.ok(Map.of(\r\n                \"scanId\", scanId,\r\n                \"projectKey\", task.getProjectKey(),\r\n                \"status\", task.getStatus()\r\n        ));\r\n    }\r\n\r\n    // =====================================\r\n    // GET FINAL RESULT (WHEN COMPLETED)\r\n    // =====================================\r\n    @GetMapping(\"/result/{scanId}\")\r\n    public ResponseEntity<?> getResult(\r\n            @PathVariable(\"scanId\") String scanId) {\r\n\r\n        ScanTask task = scanService.getScanTask(scanId);\r\n\r\n        if (task == null) {\r\n            return ResponseEntity.notFound().build();\r\n        }\r\n\r\n        if (!\"COMPLETED\".equals(task.getStatus())) {\r\n            return ResponseEntity.badRequest()\r\n                    .body(Map.of(\"error\", \"Scan not completed yet\"));\r\n        }\r\n\r\n        return ResponseEntity.ok(\r\n                scanService.getResult(scanId)\r\n        );\r\n    }\r\n\r\n    // =====================================\r\n    // GET BUILD LOG\r\n    // =====================================\r\n    @GetMapping(\"/build-log/{scanId}\")\r\n    public ResponseEntity<?> getBuildLog(\r\n            @PathVariable String scanId) {\r\n\r\n        ScanTask task = scanService.getScanTask(scanId);\r\n\r\n        if (task == null) {\r\n            return ResponseEntity.notFound().build();\r\n        }\r\n\r\n        return ResponseEntity.ok(Map.of(\r\n                \"scanId\", scanId,\r\n                \"projectKey\", task.getProjectKey(),\r\n                \"status\", task.getStatus(),\r\n                \"buildLog\", task.getBuildLog()\r\n        ));\r\n    }\r\n}\r\n"
        }
    ]
}